{% extends 'admin.twig' %}

{% block content %}
    <div style="background-color: #ffeb3b; color: #000; padding: 15px; margin-bottom: 20px; border-radius: 4px; font-weight: bold; text-align: center;">
        <h2 style="margin-top: 0;">DB-IP Updater Einstellungen</h2>
        <p>Diese Seite sollte direkt über das Menü erreichbar sein.</p>
        <p>Alternative Link: <a href="index.php?module=UserCountry&action=admin" style="color: #2c3e50;">UserCountry Admin</a></p>
    </div>
    
    <div piwik-content-block content-title="{{ 'DbipUpdater_Settings'|translate }}">
        <p>{{ 'DbipUpdater_SettingsDescription'|translate }}</p>

        <!-- Debug-Informationen -->
        <div class="dbip-debug" style="margin-bottom: 20px; padding: 10px; background: #f8f8f8; border-left: 3px solid #2c3e50; font-family: monospace;">
            <h3>Debug-Info:</h3>
            <ul>
                <li>Settings-Klasse: {{ settings is defined ? 'vorhanden' : 'nicht definiert' }}</li>
                <li>Settings-Typ: {{ settings is defined ? 'SystemSettings' : 'N/A' }}</li>
            </ul>
        </div>
        
        <div class="dbip-updater-section">
            <div piwik-form>
                {% if settings is defined and settings is not null %}
                    <form id="dbipUpdaterSettings" method="post" action="index.php?module=DbipUpdater&action=saveSettings">
                        <!-- CSRF-Token wird automatisch von Matomo hinzugefügt -->
                        
                        <div class="form-group">
                            <label>Download JSON URL:</label>
                            <input type="text" name="jsonUrl" class="form-control" value="{{ settings.jsonUrl.getValue() }}" />
                            <p class="help-block">The URL endpoint returning JSON with download links to your DB-IP files. Replace "changeme" with your DB-IP account ID.</p>
                        </div>
                        
                        <div class="form-group">
                            <label>Enable Detailed Logging:</label>
                            <input type="checkbox" name="enableDetailedLogging" value="1" {% if settings.enableDetailedLogging.getValue() %}checked="checked"{% endif %} />
                            <p class="help-block">When enabled, additional detailed information will be logged during updates. Useful for troubleshooting but may increase log size.</p>
                        </div>
                        
                        <div class="form-group">
                            <label>Connection Timeout:</label>
                            <input type="number" name="connectionTimeout" class="form-control" value="{{ settings.connectionTimeout.getValue() }}" min="5" max="120" />
                            <p class="help-block">Timeout in seconds when connecting to the JSON endpoint. Increase this value if you experience timeout issues.</p>
                        </div>
                        
                        <div class="form-group">
                            <label>Maximum Retries:</label>
                            <input type="number" name="maxRetries" class="form-control" value="{{ settings.maxRetries.getValue() }}" min="0" max="10" />
                            <p class="help-block">Number of attempts to retry download if a connection fails. Set to 0 to disable retry functionality.</p>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                {% else %}
                    <div class="alert alert-danger">
                        Es gab ein Problem beim Laden der Einstellungen. Bitte überprüfen Sie die Plugin-Konfiguration.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
